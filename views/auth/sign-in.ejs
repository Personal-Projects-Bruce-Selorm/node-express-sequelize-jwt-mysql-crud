<%- include('../partials/header') %>
<div class="container m-5">
  <div class="m-5 card">
    <div class="card-header">Sign-in</div>
    <div class="card-body">
      <div class="error unauthorized"></div>
      <form>
        <div class="form-group py-2">
          <label for="username">Username</label>
          <input type="text" class="form-control" name="username" />
          <label for="" class="error username"></label>
        </div>
        <div class="form-group py-2">
          <label for="password">Password</label>
          <input type="password" class="form-control" name="password" />
          <label for="" class="error password"></label>
        </div>
        <div class="form-group">
          <button class="btn btn-primary btn-sm" type="submit">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>

<script>
  var form = document.querySelector("form");

  //error fields
  var usernameError = document.querySelector(".error.username");
  var passwordeError = document.querySelector(".error.password");
  var unauthorizedeError = document.querySelector(".error.unauthorized");

  //listen to submit event
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    //get input
    var username = form.username.value;
    var password = form.password.value;
    console.log(username)

    //submit form
    var res = await fetch("/sign-in", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
    });
    var data = await res.json();
    console.log(data)

    if (data.errors) {
      usernameError.textContent = data.errors.username;
      passwordeError.textContent = data.errors.password;
      console.log(data.errors.unauthorized)
      unauthorizedeError.textContent = data.errors.unauthorized;

    }
    if (data.user) {
      location.assign("/dashbord");
    }
  });
</script>
